<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0" /> -->
    <title>Secure Chat</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- <script defer src="chat.js"></script> -->
  </head>
  <body>
    <h1>Secure Chat</h1>
    <button id="switch-language">Switch Language</button>
    <div class="chat-container">
      <img src="img/banner.jpg" alt="Chat banner" />
      <ul id="chat" class="chat-box"></ul>
      <div class="input-container">
        <input type="text" id="message" placeholder="Enter a message" />
        <button id="send">Send</button>
      </div>
    </div>
    <ul class="links-list">
      <li class="link-list__item">
        <a href="#">About</a>
      </li>
      <li class="link-list__item">
        <a href="./pages/help.html">Help</a>
      </li>
      <li class="link-list__item">
        <a href="https://htmlacademy.ru/blog/js/xss" target="_blank">XSS</a>
      </li>
    </ul>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const langButton = document.getElementById("switch-language");
        const sendButton = document.getElementById("send");
        const messageInput = document.getElementById("message");
        const chatBox = document.getElementById("chat");

        // Переключение языка
        if (langButton) {
          langButton.addEventListener("click", function () {
            const currentLang = window.location.pathname.includes(
              "chat_en.html"
            )
              ? "en"
              : "ru";
            const newLang = currentLang === "ru" ? "en" : "ru";
            window.location.href =
              newLang === "ru" ? "chat_ru.html" : "chat_en.html";
          });
        }

        // Переключение языка на главной странице
        const toRussian = document.getElementById("to-russian");
        const toEnglish = document.getElementById("to-english");

        if (toRussian) {
          toRussian.addEventListener(
            "click",
            () => (window.location.href = "chat_ru.html")
          );
        }

        if (toEnglish) {
          toEnglish.addEventListener(
            "click",
            () => (window.location.href = "chat_en.html")
          );
        }

        // Функция сохранения сообщений в LocalStorage
        function saveMessages() {
          console.log('Сохраните сообщение в "базу данных (localStorage)"');
        }

        // Функция загрузки сообщений из LocalStorage
        function loadMessages() {
          const savedMessages =
            JSON.parse(localStorage.getItem("chatMessages")) || [];
          savedMessages.forEach((messageText) => {
            const messageElement = document.createElement("li");
            messageElement.classList.add("message", "user-message");
            messageElement.textContent = messageText;
            chatBox.appendChild(messageElement);
          });
        }

        // Отправка сообщений с сохранением в LocalStorage
        if (sendButton) {
          sendButton.addEventListener("click", function () {
            const messageText = messageInput.value.trim();
            if (messageText === "") return;

            const messageElement = document.createElement("li");
            messageElement.classList.add("message", "user-message");
            messageElement.innerHTML = messageText;

            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
            messageInput.value = "";

            // Вызвать функцию saveMessages
          });
        }

        // Загружаем сохраненные сообщения при загрузке страницы
        loadMessages();
      });
    </script>
  </body>
</html>
